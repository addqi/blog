
# Cocos Creator 2.x å¤šç‚¹è§¦æ‘¸ç¬”è®°ï¼ˆMulti-touchï¼‰

## 1. å¤šç‚¹è§¦æ‘¸æ¦‚å¿µ

åœ¨ Cocos Creator ä¸­ï¼Œå¤šç‚¹è§¦æ‘¸å¯ä»¥è®©ä½ çš„æ¸¸æˆåŒæ—¶å“åº”å¤šä¸ªæ‰‹æŒ‡è§¦æ§äº‹ä»¶ï¼Œå¸¸ç”¨äºï¼š

* åŒæŒ‡ç¼©æ”¾ï¼ˆpinch zoomï¼‰
* ä¸¤æŒ‡æ—‹è½¬
* å¤šç‚¹æ‹–åŠ¨æˆ–å¤æ‚æ‰‹åŠ¿

é»˜è®¤ **å¤šç‚¹è§¦æ‘¸æ˜¯å¼€å¯çš„**ï¼Œé€šè¿‡ `cc.macro.ENABLE_MULTI_TOUCH` æ§åˆ¶ï¼š

```ts
// é»˜è®¤å¼€å¯
cc.macro.ENABLE_MULTI_TOUCH = true;
```

* **å•ç‚¹è§¦æ‘¸æ¨¡å¼**ï¼šåªå¤„ç†ç¬¬ä¸€ä¸ªæ‰‹æŒ‡è§¦æ‘¸äº‹ä»¶ï¼Œå…¶ä»–è§¦æ‘¸å¿½ç•¥
* **å¤šç‚¹è§¦æ‘¸æ¨¡å¼**ï¼šå¤„ç†æ‰€æœ‰æ‰‹æŒ‡è§¦æ‘¸äº‹ä»¶

---

## 2. å¸¸ç”¨è§¦æ‘¸äº‹ä»¶

Cocos Creator çš„ `cc.Node` å¯ä»¥ç›‘å¬ä»¥ä¸‹è§¦æ‘¸äº‹ä»¶ï¼š

| äº‹ä»¶ç±»å‹          | æè¿°              |
| ------------- | --------------- |
| `touchstart`  | æ‰‹æŒ‡åˆšæŒ‰ä¸‹           |
| `touchmove`   | æ‰‹æŒ‡ç§»åŠ¨            |
| `touchend`    | æ‰‹æŒ‡æŠ¬èµ·            |
| `touchcancel` | ç³»ç»Ÿå–æ¶ˆè§¦æ‘¸ï¼ˆä¾‹å¦‚æ¥ç”µã€å¼¹çª—ï¼‰ |

**äº‹ä»¶å›è°ƒå‚æ•°ï¼š** `event: cc.Event.EventTouch`

* `event.getLocation()` â†’ è·å–è§¦æ‘¸ç‚¹å±å¹•åæ ‡
* `event.getDelta()` â†’ ç›¸å¯¹äºä¸Šæ¬¡è§¦æ‘¸ç§»åŠ¨çš„ä½ç§»
* `event.getTouches()` â†’ è·å–å½“å‰æ‰€æœ‰è§¦æ‘¸ç‚¹ï¼ˆå¤šç‚¹è§¦æ‘¸æ—¶ä½¿ç”¨ï¼‰
* `event.getID()` â†’ è·å–è§¦æ‘¸ç‚¹å”¯ä¸€ ID

---

## 3. å•ç‚¹è§¦æ‘¸ç¤ºä¾‹

```ts
const { ccclass, property } = cc._decorator;

@ccclass
export default class SingleTouch extends cc.Component {

    onLoad() {
        // å•ç‚¹è§¦æ‘¸
        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);
        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);
        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);
    }

    onTouchStart(event: cc.Event.EventTouch) {
        const pos = event.getLocation();
        console.log('å•ç‚¹è§¦æ‘¸å¼€å§‹', pos);
    }

    onTouchMove(event: cc.Event.EventTouch) {
        const delta = event.getDelta();
        this.node.x += delta.x;
        this.node.y += delta.y;
    }

    onTouchEnd(event: cc.Event.EventTouch) {
        console.log('å•ç‚¹è§¦æ‘¸ç»“æŸ');
    }
}
```

---

## 4. å¤šç‚¹è§¦æ‘¸ç¤ºä¾‹

```ts
const { ccclass, property } = cc._decorator;

@ccclass
export default class MultiTouchExample extends cc.Component {

    onLoad() {
        // ç¡®ä¿å¤šç‚¹è§¦æ‘¸å¼€å¯
        cc.macro.ENABLE_MULTI_TOUCH = true;

        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);
        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);
        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);
        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);
    }

    onTouchStart(event: cc.Event.EventTouch) {
        const touches = event.getTouches();
        touches.forEach(t => {
            const pos = t.getLocation();
            console.log('å¤šç‚¹è§¦æ‘¸å¼€å§‹ ID:', t.getID(), 'ä½ç½®:', pos);
        });
    }

    onTouchMove(event: cc.Event.EventTouch) {
        const touches = event.getTouches();
        touches.forEach(t => {
            const delta = t.getDelta();
            console.log('ID:', t.getID(), 'ç§»åŠ¨ä½ç§»:', delta);
        });
    }

    onTouchEnd(event: cc.Event.EventTouch) {
        console.log('è§¦æ‘¸ç»“æŸ ID:', event.getID());
    }

    onTouchCancel(event: cc.Event.EventTouch) {
        console.log('è§¦æ‘¸å–æ¶ˆ ID:', event.getID());
    }
}
```

### ğŸ”¹ è¯´æ˜

1. `getTouches()` è¿”å›å½“å‰æ‰€æœ‰æ´»è·ƒè§¦æ‘¸ç‚¹
2. `getID()` ç”¨äºåŒºåˆ†ä¸åŒæ‰‹æŒ‡
3. å¤šç‚¹è§¦æ‘¸å¸¸ç”¨é…åˆ **åŒæŒ‡ç¼©æ”¾** æˆ– **æ—‹è½¬** æ‰‹åŠ¿

---

## 5. å¸¸è§æ‰‹åŠ¿å¤„ç†æ€è·¯

* **åŒæŒ‡ç¼©æ”¾**ï¼š

```ts
if (touches.length === 2) {
    const pos1 = touches[0].getLocation();
    const pos2 = touches[1].getLocation();
    const distance = pos1.sub(pos2).mag();
    // ç”¨ distance åˆ¤æ–­ç¼©æ”¾æ¯”ä¾‹
}
```

* **æ—‹è½¬æ‰‹åŠ¿**ï¼š

```ts
const delta = touches[0].getLocation().sub(touches[1].getLocation());
const angle = Math.atan2(delta.y, delta.x) * 180 / Math.PI;
this.node.rotation = angle; 
```

---

## 6. æ³¨æ„äº‹é¡¹

1. `cc.macro.ENABLE_MULTI_TOUCH` å¿…é¡»åœ¨è„šæœ¬åˆå§‹åŒ–ä¹‹å‰è®¾ç½®ï¼Œå¦åˆ™é»˜è®¤å¤šç‚¹è§¦æ‘¸å¼€å¯
2. å¤šç‚¹è§¦æ‘¸ä¼šå½±å“äº‹ä»¶é¡ºåºï¼šæ¯ä¸ªè§¦æ‘¸ç‚¹éƒ½ä¼šè§¦å‘å¯¹åº”äº‹ä»¶
3. `touchcancel` åœ¨ç³»ç»Ÿä¸­æ–­è§¦æ‘¸æ—¶è§¦å‘ï¼ˆä¾‹å¦‚å¼¹çª—ã€ç³»ç»Ÿæ‰‹åŠ¿ï¼‰

---


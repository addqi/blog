---
title: 第一章 Canvas UI 适配
date: 2025-01-20 00:00:00
tags:
  - Cocos-Creator
  - 游戏开发
---

## 一、概述

在不同分辨率、不同屏幕比例（16:9、18:9、全面屏、Pad 等）的设备上，UI 是否能够**正确显示且不变形**是游戏开发中必须解决的问题。

本章将系统介绍 **Cocos Creator 中 Canvas 与 Widget 的 UI 适配方案**，包括：

* Canvas 的 Fit Width / Fit Height 工作原理
* 常见屏幕适配策略
* Widget（对齐挂件）的使用方式
* Widget 对节点位置与尺寸的影响
* 实战中常见的 UI 布局组合方案

---

## 二、Canvas 适配机制

### 2.1 Canvas 的作用

Canvas 是 **UI 的根节点**，负责将设计分辨率映射到真实设备分辨率。

在 Cocos Creator 中，Canvas 主要通过以下两个选项完成适配：

* **Fit Width**：以屏幕宽度为基准进行缩放
* **Fit Height**：以屏幕高度为基准进行缩放

---

### 2.2 Fit Width / Fit Height 说明

| 设置方式         | 效果             | 适用场景      |
| ------------ | -------------- | --------- |
| 仅 Fit Width  | 宽度铺满，高度可能裁剪    | 横版游戏      |
| 仅 Fit Height | 高度铺满，宽度可能裁剪    | 竖版游戏      |
| 同时勾选         | 内容完整显示，但可能出现黑边 | 需要完整展示 UI |

> ✅ **同时勾选 Fit Width 和 Fit Height**：
>
> * 能保证 UI 内容完整显示
> * 在屏幕比例不一致时，会产生 **黑边（Letter Box）**

这是一种**安全但不极致**的适配方式。

---

## 三、Widget（对齐挂件）基础

### 3.1 Widget 的作用

Widget（对齐挂件）是 Cocos Creator 中**最核心的 UI 布局组件**，用于：

* 将节点对齐到父节点或屏幕边缘
* 根据屏幕大小自动调整位置和尺寸
* 快速实现多分辨率 UI 适配

> 📌 **绝大多数 UI 自适配都依赖 Widget 完成**。

---

### 3.2 对齐参照目标（Target）

* **未设置 Target**：默认以父节点作为对齐参照
* **父节点是 Canvas**：对齐到屏幕可见区域（visibleRect）

常见用途：

* 顶部状态栏贴屏幕上边
* 按钮固定在屏幕右下角

---

## 四、Widget 选项详解

### 4.1 边界对齐选项

| 选项                | 说明    | 备注         |
| ----------------- | ----- | ---------- |
| Top               | 对齐上边界 | 可设置像素或百分比  |
| Bottom            | 对齐下边界 | 百分比基于父节点高度 |
| Left              | 对齐左边界 | 百分比基于父节点宽度 |
| Right             | 对齐右边界 | 常用于按钮停靠    |
| Horizontal Center | 水平居中  | 忽略左右偏移     |
| Vertical Center   | 垂直居中  | 忽略上下偏移     |

---

### 4.2 Align Mode（对齐模式）

| 模式               | 行为说明      | 使用建议     |
| ---------------- | --------- | -------- |
| ONCE             | 仅初始化时对齐一次 | ⭐ 推荐默认使用 |
| ON_WINDOW_RESIZE | 窗口变化时重新对齐 | Web / PC |
| ALWAYS           | 每帧对齐      | ⚠️ 慎用    |

---

## 五、常见对齐示例

### 5.1 边界对齐

* **左对齐，左边距 100px**

  * Left = 100

* **下对齐，下边距 50%**

  * Bottom = 0.5
  * 百分比以父节点高度为基准

* **右下角对齐，边距 0px**

  * Right = 0
  * Bottom = 0

---

### 5.2 居中对齐

* **水平居中**

  * Horizontal Center 勾选

* **垂直居中 + 右边距 50%**

  * Vertical Center
  * Right = 0.5

---

## 六、约束尺寸（拉伸）

### 6.1 拉伸规则

* **左右同时对齐 → 宽度拉伸**
* **上下同时对齐 → 高度拉伸**
* **上下 + 左右 → 宽高同时拉伸**

---

### 6.2 常见拉伸案例

* **宽度拉伸，左右边距 10%**

  * Left = 0.1
  * Right = 0.1

* **高度拉伸，上下 0，水平居中**

  * Top = 0
  * Bottom = 0
  * Horizontal Center

* **四边拉伸，边距 50px**

  * Top / Bottom / Left / Right = 50

> 📌 拉伸 UI（如对话框、背景图）通常配合 **Sprite 的 Sliced 模式** 使用。

---

## 七、Widget 对节点属性的影响

### 7.1 ALWAYS 模式的限制

当 Align Mode 设置为 **ALWAYS** 时：

* 节点的 `position`、`width`、`height` 会被 **每帧重置**
* 无法通过代码或动画系统自由修改

原因：

> Widget 的对齐逻辑在 **每帧最后阶段执行**，会覆盖你的修改。

---

### 7.2 正确的解决方案

#### 方案一：使用 ONCE（推荐）

* 初始化时完成一次对齐
* 之后可自由使用动画 / 脚本修改 UI

#### 方案二：通过 Widget 属性驱动动画

* 使用 `top / bottom / left / right` 作为动画关键帧
* 在保持对齐规则的同时实现 UI 动效

---

## 八、注意事项

* Widget 自动调整的位置和尺寸 **下一帧才能获取**
* 如需立即获取结果，可手动调用：

```ts
widget.updateAlignment();
```

---

## 九、总结

* **Canvas 决定整体缩放规则**
* **Widget 决定 UI 的布局与对齐**
* 推荐策略：

  * Canvas：Fit Width + Fit Height
  * Widget：ONCE + 合理边距

> 🎯 熟练使用 Widget，是做好 UI 适配的关键能力之一。
